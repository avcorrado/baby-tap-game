<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Baby Smash — Musical Mode</title>
  <style>
    :root {
      --bg-normal: #251d2b;
      /* normal dark-ish purple background */
      --bg-calm: #1a1620;
      /* calmer background for calm mode */
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: var(--bg-normal);
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      transition: background 0.5s;
    }

    #app {
      position: relative;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center
    }

    canvas {
      position: absolute;
      inset: 0;
      display: block
    }

    .ui {
      position: absolute;
      left: 12px;
      top: 12px;
      z-index: 30;
      color: #fff;
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(6px);
      padding: 10px;
      border-radius: 12px;
      user-select: none;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .btn {
      cursor: pointer;
      border: 0;
      padding: 8px 10px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background: rgba(255 255 255 / 0.2);
    }

    .big-hint {
      position: absolute;
      z-index: 10;
      pointer-events: none;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 28px;
      opacity: .1;
      text-align: center
    }

    .footer {
      position: absolute;
      right: 12px;
      bottom: 12px;
      color: #ddd;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.2);
      padding: 8px;
      border-radius: 8px
    }
  </style>
</head>

<body>
  <div id="app">
    <canvas id="c"></canvas>
    <div class="ui">
      <div style="font-weight:700;">Baby Smash — Musical Mode</div>
      <button class="btn" id="mute">Mute</button>
      <button class="btn" id="fullscreen">Fullscreen</button>
      <button class="btn" id="toggleMode">Calm Mode</button>
    </div>
    <div class="big-hint">Press Keys<br />or Tap Screen</div>
    <div class="footer">Musical notes & bright visuals</div>
  </div>
  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = innerWidth;
    let H = canvas.height = innerHeight;
    window.addEventListener('resize', () => {
      W = canvas.width = innerWidth;
      H = canvas.height = innerHeight;
    });

    // audio
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const ac = new AudioContext();
    let masterGain = ac.createGain();
    masterGain.gain.value = 0.8;
    masterGain.connect(ac.destination);
    let muted = false;

    function resumeAudio() {
      if (ac.state !== 'running') {
        ac.resume();
      }
    }

    // C major scale frequencies
    const scale = [261.63, 293.66, 329.63, 349.23, 392.0, 440.0, 493.88];

    // Calm mode flag
    let calmMode = false;

    function playNiceTone() {
      if (muted) return;
      resumeAudio();
      const note = scale[Math.floor(Math.random() * scale.length)];
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.frequency.value = note;

      if (calmMode) {
        masterGain.gain.value = 0.5; // reduce volume a bit
        // Calm mode: drone-like soft tone using sine wave, slow pitch modulation
        o.type = 'sine';
        g.gain.value = 0.3;
        o.connect(g);
        g.connect(masterGain);
        const now = ac.currentTime;
        g.gain.setValueAtTime(0.3, now);
        g.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
        // slow pitch modulation to simulate drone
        o.frequency.setValueAtTime(note * 0.99, now);
        o.frequency.linearRampToValueAtTime(note * 1.01, now + 0.75);
        o.frequency.linearRampToValueAtTime(note * 0.99, now + 1.5);
        o.start(now);
        o.stop(now + 1.5);
      } else {
        masterGain.gain.value = 0.8; // normal volume
        // Normal mode: triangle wave with pitch drop
        o.type = 'triangle';
        g.gain.value = 0.3;
        o.connect(g);
        g.connect(masterGain);
        const now = ac.currentTime;
        g.gain.setValueAtTime(0.3, now);
        g.gain.exponentialRampToValueAtTime(0.001, now + 1);
        o.frequency.exponentialRampToValueAtTime(note * 0.98, now + 0.5);
        o.start(now);
        o.stop(now + 1.1);
      }
    }

    // visuals
    const particles = [];

    function spawnParticle(x, y) {
      // increase size and velocity by 1.5x in calm mode
      const sizeBase = 10 + Math.random() * 20;
      const size = calmMode ? sizeBase * 1.5 : sizeBase;
      const velocityFactor = calmMode ? 1.5 : 1;
      particles.push({
        x,
        y,
        vx: (Math.random() - 0.5) * 4 * velocityFactor,
        vy: (Math.random() - 0.5) * 4 * velocityFactor,
        life: 80,
        size,
        hue: Math.floor(Math.random() * 360)
      });
    }

    function drawParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        ctx.globalAlpha = Math.max(0, p.life / 80);

        // Soften colors and reduce saturation in calm mode
        if (calmMode) {
          ctx.fillStyle = `hsl(${p.hue}, 20%, 80%)`; // softer, less saturated colors
        } else {
          ctx.fillStyle = `hsl(${p.hue}, 90%, 60%)`; // bright colors
        }

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
        if (p.life <= 0) particles.splice(i, 1);
      }
    }

    function triggerAction(x, y) {
      playNiceTone();
      const count = calmMode ? 4 : 8; // fewer particles in calm mode
      for (let i = 0; i < count; i++) spawnParticle(x, y);
    }

    // inputs
    let lastPointer = { x: W / 2, y: H / 2 };
    window.addEventListener('pointermove', e => {
      lastPointer.x = e.clientX;
      lastPointer.y = e.clientY;
    });
    window.addEventListener('keydown', e => {
      triggerAction(lastPointer.x, lastPointer.y);
    });
    window.addEventListener('pointerdown', e => {
      triggerAction(e.clientX, e.clientY);
    });

    // buttons
    const muteBtn = document.getElementById('mute');
    muteBtn.onclick = () => {
      muted = !muted;
      muteBtn.textContent = muted ? 'Unmute' : 'Mute';
      if (!calmMode) masterGain.gain.value = muted ? 0 : 0.8;
      else masterGain.gain.value = muted ? 0 : 0.5;
    };

    document.getElementById('fullscreen').onclick = () => {
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    };

    const toggleModeBtn = document.getElementById('toggleMode');
    const footer = document.querySelector('.footer');

    toggleModeBtn.onclick = () => {
      calmMode = !calmMode;
      if (calmMode) {
        document.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-calm');
        footer.textContent = "Calm Mode — softer colors and drone sound";
        toggleModeBtn.textContent = "Normal Mode";
        if (!muted) masterGain.gain.value = 0.5;
      } else {
        document.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-normal');
        footer.textContent = "Musical notes & bright visuals";
        toggleModeBtn.textContent = "Calm Mode";
        if (!muted) masterGain.gain.value = 0.8;
      }
    };

    // loop
    function loop() {
      ctx.clearRect(0, 0, W, H);
      ctx.fillStyle = getComputedStyle(document.body).backgroundColor;
      ctx.fillRect(0, 0, W, H);
      drawParticles();
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>

</html>